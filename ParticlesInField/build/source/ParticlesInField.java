/* autogenerated by Processing revision 1277 on 2021-12-25 */
import processing.core.*;
import processing.data.*;
import processing.event.*;
import processing.opengl.*;

import java.util.HashMap;
import java.util.ArrayList;
import java.io.File;
import java.io.BufferedReader;
import java.io.PrintWriter;
import java.io.InputStream;
import java.io.OutputStream;
import java.io.IOException;

public class ParticlesInField extends PApplet {

//Particle Class
class Particle {
  PVector pos;
  PVector vel;
  PVector acc;
  float  mass;
  //float dt;
  float r;

  Particle(PVector v) {
    pos = v;
    vel = new PVector(random(-0.1f,0.1f),random(-0.1f,0.1f));
    acc = new PVector(0,0);
    mass = random(-5,5);
    r = 2;
  }

   public void run(ArrayList<Particle> particles) {
    update(particles);
    display();
    borders();
  }
  // updates data of particle
   public void update(ArrayList<Particle> particles) {
    vel.add(Force(field(particles)));
    pos.add(vel);
  }
  // how the particle looks like
   public void display() {
    stroke(255);
    fill(255);
    ellipse(pos.x, pos.y, abs(mass)*r,abs(mass)*r);
  }

  // The field from other particles
   public ArrayList<PVector> field(ArrayList<Particle> particles) {
    ArrayList<PVector> extFields = new ArrayList<PVector>();

    for (Particle other : particles) {
      PVector distance = PVector.sub(pos, other.pos);
      if (distance.mag() > 0) {
        extFields.add(distance.normalize().mult(mass).div(distance.magSq()));
      }
    }
    return(extFields);
    }

  // The force the particle notices
   public PVector Force(ArrayList<PVector> fields) {
    PVector force = new PVector(0,0);
    for (PVector field : fields){
      force.add(field);
    }
    return(force.div(100));
  }


  // Wrap
   public void borders() {
      if (pos.x < -width/2) pos.x = width/2 ;
      if (pos.y < -r) pos.y = height+r;
      if (pos.x > width+r) pos.x = -r;
      if (pos.y > height+r) pos.y = -r;
  }


}

// Display setup and draw
ArrayList<Particle> particles;

 public void setup() {
  /* size commented out by preprocessor */;
  particles = new ArrayList<Particle>();
  PVector p = new PVector(0,0);
}


 public void draw() {
  background(0);
  if (particles != null) {
    for (Particle all : particles) {
      all.run(particles);
    }
  }
}


 public void mousePressed() {
  particles.add(new Particle(new PVector(mouseX, mouseY)));
}


  public void settings() { size(640, 360); }

  static public void main(String[] passedArgs) {
    String[] appletArgs = new String[] { "ParticlesInField" };
    if (passedArgs != null) {
      PApplet.main(concat(appletArgs, passedArgs));
    } else {
      PApplet.main(appletArgs);
    }
  }
}
